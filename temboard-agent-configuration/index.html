<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="author" content="www.dalibo.com">
  
  <title>Configure - Temboard</title>
  

  <link rel="shortcut icon" href="../img/favicon.ico">

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../css/highlight.css">

  
  <script>
    // Current page data
    var mkdocs_page_name = "Configure";
    var mkdocs_page_input_path = "temboard-agent-configuration.md";
    var mkdocs_page_url = "/temboard-agent-configuration/index.html";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js"></script>
  <script src="../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../js/highlight.pack.js"></script>
  <script src="../js/theme.js"></script> 

  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../README/index.html" class="icon icon-home"> Temboard</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        <ul class="current">
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../README/index.html">Home</a>
        
    </li>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Agent</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../temboard-agent-install-debian/index.html">Install on Debian</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../temboard-agent-install-rpm/index.html">Install On Red Hat</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../temboard-agent-install-sources/index.html">Install From Source</a>
        
    </li>

        
            
    <li class="toctree-l1 current">
        <a class="current" href="index.html">Configure</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#temboard-agent-configuration">temboard-agent configuration</a></li>
                
                    <li><a class="toctree-l4" href="#ssl-certificate">SSL certificate</a></li>
                
                    <li><a class="toctree-l4" href="#the-configuration-file">The configuration file</a></li>
                
            
            </ul>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Server</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../temboard-install-debian/index.html">Install on Debian</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../temboard-install-rpm/index.html">Install On Red Hat</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../temboard-install-sources/index.html">Intall From source</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../temboard-repository-setup/index.html">Setup</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../temboard-howto/index.html">How To</a>
        
    </li>

        
    </ul>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../README/index.html">Temboard</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../README/index.html">Docs</a> &raquo;</li>
    
      
        
          <li>Agent &raquo;</li>
        
      
    
    <li>Configure</li>
    <li class="wy-breadcrumbs-aside">
      
        
          <a href="https://github.com/dalibo/temboard/tree/master/doc" class="icon icon-github"> Edit on GitHub</a>
        
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="temboard-agent-configuration"><code>temboard-agent</code> configuration</h1>
<h2 id="ssl-certificate">SSL certificate</h2>
<p><code>temboard-agent</code> embeds a lightweight HTTPS server aimed to serve its API, thus it is required to use a SSL certificate. As long as the agent's API is not reachable through a public interface, usage of self-signed certificates is safe.</p>
<h3 id="using-provided-ssl-certificate">Using provided SSL certificate</h3>
<p><code>temboard-agent</code> provides a ready to use self-signed SSL certifcate located in <code>/usr/share/temboard-agent</code> directory, if you don't want to use it, you can create a new one with the <code>openssl</code> binary.</p>
<pre><code>$ sudo cp /usr/share/temboard-agent/temboard-agent_CHANGEME.key /etc/temboard-agent/ssl/.
$ sudo cp /usr/share/temboard-agent/temboard-agent_CHANGEME.pem /etc/temboard-agent/ssl/.
$ sudo chown postgres.postgres /etc/temboard-agent/ssl/*
</code></pre>

<h3 id="build-a-new-self-signed-certificate">Build a new self-signed certificate</h3>
<p>To build a new SSL certifcate:</p>
<pre><code>$ sudo -u postgres openssl req -new -x509 -days 365 -nodes -out /etc/temboard-agent/ssl/localhost.pem -keyout /etc/temboard-agent/ssl/localhost.key
</code></pre>

<p>Then, <code>ssl_cert_file</code> and <code>ssl_key_file</code> parameters from <code>temboard-agent.conf</code> file need to be set respectively to <code>/etc/temboard-agent/ssl/localhost.pem</code> and <code>/etc/temboard-agent/ssl/localhost.key</code>.</p>
<h3 id="ca-certificate-file">CA certificate file</h3>
<p>The plugin <code>supervision</code> sends periodically collected data to the collector (API served by the temBoard UI web server) through HTTPS. To allow this data flow, the HTTPS client implemented by the agent needs to have the UI's SSL certifcate (.pem) stored in its CA certificate file. temBoard agent embeds a default CA cert. file containing default temBoard UI SSL certificate.</p>
<pre><code>$ sudo cp /usr/share/temboard-agent/temboard-agent_ca_certs_CHANGEME.pem /etc/temboard-agent/ssl/ca_certs_localhost.pem
</code></pre>

<p><code>ssl_ca_cert_file</code> parameter in section <code>[supervision]</code> from the configuration file needs to be set to <code>/etc/temboard-agent/ssl/ca_certs_localhost.pem</code>.</p>
<h3 id="restrictions-on-ssl-files">Restrictions on SSL files</h3>
<pre><code>$ sudo chmod 0600 /etc/temboard-agent/ssl/*
</code></pre>

<h3 id="access-to-postgresql-cluster">Access to PostgreSQL Cluster</h3>
<p>The agent needs a PostgreSQL superuser. By default, it is configured to work with <code>postgres</code> user.</p>
<p>To create a dedicated one with password authentication:</p>
<pre><code>$ sudo -u postgres createuser temboard -s -P
</code></pre>

<p>This superuser should be able to connect to the cluster through the unix socket using a password, check <code>pg_hba.conf</code> file and reload configuration.
Example of <code>pg_hba.conf</code> entry:</p>
<pre><code>local   postgres        temboard                                  md5
</code></pre>

<p>The access to the PostgreSQL cluster is then configured in the <code>[postgresql]</code> section of the <code>/etc/temboard-agent/temboard-agent.conf</code> file.</p>
<h3 id="users">Users</h3>
<p>When interacting with the agent using HTTP, for example when accessing certain pages in the Web UI, an authentication is required. Accounts are created using the <code>temboard-agent-adduser</code>.</p>
<p>Add a first user:</p>
<pre><code>$ sudo -u postgres temboard-agent-adduser
</code></pre>

<h3 id="registration-in-the-web-ui-of-the-supersivion-plugin">Registration in the Web UI of the supersivion plugin</h3>
<p>In the <code>temboard-agent.conf</code> file, 2 parameters must be configurated to make the agent interact with the UI. The first one is <code>key</code> and is a string used to uniquely identify the agent in the UI, it let the UI allow the agent to push its metric data.</p>
<p>The best way to configure the agent key is to generate a random string of letters and number:</p>
<pre><code>$ cat /dev/urandom | tr -dc '[:alnum:]' | fold -w 64 | head -1
</code></pre>

<p>The second is <code>collector_url</code>. It lets the agent know where to post its data. Just change the hostname to point to the UI. Since the UI is only reachable using HTTPS, the UI SSL certificate (or CA certificates that has issued it) must be in the filepath where <code>ssl_ca_cert_file</code> points.</p>
<h2 id="the-configuration-file">The configuration file</h2>
<p>The configuration file <code>temboard-agent.conf</code> is formated using INI format. Configuration parameters are distributed under sections:
  - <code>[temboard]</code>: this is the main section grouping core parameters;
  - <code>[postgresql]</code>: parameters related to the PostgreSQL cluster that the agent is connected to;
  - <code>[logging]</code>: how and where to log;
  - <code>[dashboard]</code>: parameters of the plugin <code>dashboard</code>;
  - <code>[supervision]</code>: plugin <code>supervision</code>;
  - <code>[administration]</code>: plugin <code>administration</code>.</p>
<h3 id="temboard"><code>[temboard]</code></h3>
<ul>
<li><code>port</code>: port number that the agent will listen on to serve its <code>HTTP API</code>. Default: <code>2345</code>;</li>
<li><code>address</code>: IP v4 address that the agent will listen on. Default: <code>0.0.0.0</code> (all);</li>
<li><code>users</code>: Path to the file containing the list of the users allowed to use the <code>HTTP API</code>. Default: <code>/etc/temboard-agent/users</code>;</li>
<li><code>plugins</code>: Array of plugin (name) to load. Default: <code>["supervision", "dashboard", "settings", "administration", "activity"]</code>;</li>
<li><code>ssl_cert_file</code>: Path to SSL certificate file (.pem) for the embeded HTTPS process serving the API. Default: <code>/etc/temboard-agent/ssl/temboard-agent_CHANGEME.pem</code>;</li>
<li><code>ssl_key_file</code>: Path to SSL private key file. Default: <code>/etc/temboard-agent/ssl/temboard-agent_CHANGEME.key</code>;</li>
<li><code>home</code>: Path to agent home directory, it contains files used to store temporary data. When running multiple agents on the same host, each agent must have its own home directory. Default: <code>/var/lib/temboard-agent/main</code>.</li>
<li><code>hostname</code>: Overload real machine hostname. Must be a valid FQDN. Default: <code>None</code>;</li>
</ul>
<h3 id="postgresql"><code>[postgresql]</code></h3>
<ul>
<li><code>host</code>: Path to PostgreSQL unix socket. Default: <code>/var/run/postgresql</code>;</li>
<li><code>port</code>: PostgreSQL port number. Default: <code>5432</code>;</li>
<li><code>user</code>: PostgreSQL user, Must be a super-user. Default: <code>postgres</code>;</li>
<li><code>password</code>: User password. Default: <code>None</code>;</li>
<li><code>dbname</code>: Database name for the connection. Default: <code>postgres</code>;</li>
<li><code>instance</code>: Cluster name. Default: <code>main</code>.</li>
<li><code>key</code>: Authentication key used to send data to the UI. Default: <code>None</code>;</li>
</ul>
<h3 id="logging"><code>[logging]</code></h3>
<ul>
<li><code>method</code>: Method used to send the logs: <code>stderr</code>, <code>syslog</code> or <code>file</code>. Default: <code>syslog</code>;</li>
<li><code>facility</code>: Syslog facility. Default: <code>local0</code>;</li>
<li><code>destination</code>: Path to the log file. Default: <code>/dev/log</code>;</li>
<li><code>level</code>: Log level, can be set to <code>DEBUG</code>, <code>INFO</code>, <code>WARNING</code>, <code>ERROR</code> or <code>CRITICAL</code>. Default: <code>INFO</code>.</li>
</ul>
<h3 id="dashboard"><code>[dashboard]</code></h3>
<ul>
<li><code>scheduler_interval</code>: Time interval, in second, between each run of the process collecting data used to render the dashboard. Default: <code>2</code>;</li>
<li><code>history_length</code>: Number of record to keep. Default: <code>20</code>.</li>
</ul>
<h3 id="supervision"><code>[supervision]</code></h3>
<ul>
<li><code>dbnames</code>: Database name list (comma separator) to supervise. * for all. Default: <code>*</code>;</li>
<li><code>collector_url</code>: Collector URL. Default: <code>None</code>;</li>
<li><code>probes</code>: List of probes to run, comma separator, * for all. Default: <code>*</code>;</li>
<li><code>scheduler_interval</code>: Interval, in second, between each run of the process executing the probes. Default: <code>60</code>;</li>
<li><code>ssl_ca_cert_file</code>: File where to store collector's SSL certificate. Default: <code>None</code>.</li>
</ul>
<h3 id="administration"><code>[administration]</code></h3>
<ul>
<li><code>pg_ctl</code>: External command used to start/stop PostgreSQL. Default: <code>None</code>.</li>
</ul>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../temboard-install-debian/index.html" class="btn btn-neutral float-right" title="Install on Debian">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../temboard-agent-install-sources/index.html" class="btn btn-neutral" title="Install From Source"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
      <p>Copyright 2015-2016 <a href="http://www.dalibo.com">dalibo</a></p>
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/dalibo/temboard/tree/master/doc" class="icon icon-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../temboard-agent-install-sources/index.html" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../temboard-install-debian/index.html" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>

</body>
</html>
